<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>thss15fyt</title>
		<description>Welcome to my blog~</description>
		<link>http://localhost:4000</link>
		<atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml" />
		
			<item>
				<title>微信抢票｜在服务器端部署项目的发布版本</title>
				<description>&lt;p&gt;在服务器端部署发布项目时，除项目本身需要配置外，还需要更根据Web服务器的不同进行配置，
以下给出了使用Django自带服务器和uwsgi服务器的配置方法，均适用nginx进行转发。&lt;/p&gt;

&lt;h2 id=&quot;项目配置&quot;&gt;项目配置&lt;/h2&gt;
&lt;p&gt;1.修改&lt;code class=&quot;highlighter-rouge&quot;&gt;config.json&lt;/code&gt;文件，关闭&lt;code class=&quot;highlighter-rouge&quot;&gt;DEBUG&lt;/code&gt;模式&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;DEBUG&quot;: false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.修改&lt;code class=&quot;highlighter-rouge&quot;&gt;WeChatTicket/settings.py&lt;/code&gt;文件，关闭&lt;code class=&quot;highlighter-rouge&quot;&gt;TEMPLATES&lt;/code&gt;中的&lt;code class=&quot;highlighter-rouge&quot;&gt;APP_DIRS&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;TEMPLATES = [
  {
    ...
    'APP_DIRS': False,
    ...
    },
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;使用django服务器&quot;&gt;使用Django服务器&lt;/h2&gt;
&lt;p&gt;1.修改&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/nginx/conf.d/wct.conf&lt;/code&gt;文件&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
 root /home/ubuntu/WeChatTicket/static;
 }
location /wechat {
 proxy_pass http://127.0.0.1:8000;
 }
location /api {
 proxy_pass http://127.0.0.1:8000;
} 2.在8000端口运行Django服务器

python manage.py runserver 0:8000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;也可以使进程在后台运行&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;(python manage.py runserver &amp;amp;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;需要关闭服务器进程时&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; lsof -i :8000
&amp;gt; kill -9 &amp;lt;PID&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.重启nginx服务&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; touch reload
&amp;gt; service nginx restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;使用uwsgi服务器&quot;&gt;使用uwsgi服务器&lt;/h2&gt;
&lt;p&gt;1.修改&lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/nginx/conf.d/wct.conf&lt;/code&gt;文件&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
 root /home/ubuntu/WeChatTicket/static;
 }
location /wechat {
 uwsgi_pass unix:///home/ubuntu/WeChatTicket/wct.sock;
 include /etc/nginx/uwsgi_params;
 }
location /api {
 uwsgi_pass unix:///home/ubuntu/WeChatTicket/wct.sock;
 include /etc/nginx/uwsgi_params;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.重启uwsgi&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; sudo su
&amp;gt; ps -aux | grep uwsgi
&amp;gt; kill -9 &amp;lt;PID&amp;gt;
&amp;gt; exit

&amp;gt; uwsgi --ini uwsgi.ini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.重启nginx&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; touch reload
&amp;gt; service nginx restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
				<pubDate>Thu, 12 Oct 2017 00:00:00 +0800</pubDate>
				<link>http://localhost:4000/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91/2017/10/12/WeChatTicket-server-release.html</link>
				<guid isPermaLink="true">http://localhost:4000/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91/2017/10/12/WeChatTicket-server-release.html</guid>
			</item>
		
			<item>
				<title>微信抢票｜利用SSH端口转发实现内网穿透</title>
				<description>&lt;p&gt;由于某些原因，清华校内网不再允许外网访问，给微信项目的本地开发造成了一定困难，为此可以SSH端口转发的方法进行“内网穿透”，即主动向外网服务器发起请求建立SSH通道，在服务器建立socket监听某个端口，将数据通过SSH通道发送给内网的本地服务器，处理后经同样方法进行回传。&lt;/p&gt;

&lt;p&gt;服务器端的配置方法见 &lt;a href=&quot;https://blog.magichc7.com/?p=5&amp;amp;from=timeline&quot;&gt;How to Set Up My First Server?&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;step-1&quot;&gt;STEP 1&lt;/h2&gt;
&lt;p&gt;修改服务器端nginx转发，将监听的80端口转发到闲置端口（以7000为例）:&lt;/p&gt;

&lt;p&gt;/etc/nginx/conf.d/wct.conf:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;location / {
 proxy_pass http://127.0.0.1:7000;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-2&quot;&gt;STEP 2&lt;/h2&gt;
&lt;p&gt;本地运行Django项目（假设运行在8000端口），并建立SSH远程转发，命令格式为：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -R &amp;lt;remote port&amp;gt;:localhost:&amp;lt;local port&amp;gt; &amp;lt;username&amp;gt;@&amp;lt;host ip&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在本例中为：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -R 7000:localhost:8000 ubuntu@&amp;lt;your ip&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;step-3&quot;&gt;STEP 3&lt;/h2&gt;
&lt;p&gt;经过以上两个步骤，即可通过服务器ip对本地运行的Django项目进行访问，但微信消息中的“绑定”、“帮助”等链接依然无法访问，这是因为获取的url仍为通过本地ip进行访问，为此需要对&lt;code class=&quot;highlighter-rouge&quot;&gt;config.json&lt;/code&gt;中的&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;SITE_DOMAIN&quot;&lt;/code&gt;进行修改：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&quot;SITE_DOMAIN&quot;: &quot;http://&amp;lt;your_server_ip&amp;gt;&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;qa&quot;&gt;Q&amp;amp;A&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Q:&lt;/strong&gt; 建立ssh连接时遇到：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Warning: remote port forwarding failed for listen port XXXX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;A:&lt;/strong&gt; 进入服务器，查询并结束占用端口的进程&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; sudo su
&amp;gt; netstat -tunlp
&amp;gt; kill -s 9 &amp;lt;PID&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
				<pubDate>Mon, 09 Oct 2017 00:00:00 +0800</pubDate>
				<link>http://localhost:4000/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91/2017/10/09/WeChatTicket-ssh-portforwarding.html</link>
				<guid isPermaLink="true">http://localhost:4000/%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91/2017/10/09/WeChatTicket-ssh-portforwarding.html</guid>
			</item>
		
	</channel>
</rss>
